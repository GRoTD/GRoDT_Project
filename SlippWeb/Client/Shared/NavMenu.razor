@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using MudBlazor.Utilities
@using System.Dynamic
@using System.Formats.Asn1
@using System.Linq.Expressions
@using System.Net.Mime
@using System.Security.Cryptography.X509Certificates
@using Microsoft.EntityFrameworkCore.Design.Internal
@using Microsoft.VisualBasic.CompilerServices
@using MudBlazor.Charts.SVG.Models
@inject IAuthenticationService AuthenticationService
@implements IDisposable


@*TODO - Hide appbar if soft/OnScreen keyboard is showing*@
@*TODO - Filled and outlined icons while on page*@

<MudAppBar Class="pt-1 pb-4" DisableGutters="false" Fixed="true" Bottom="true" Style="background-color:#121821; border-top: #725C3D 1px solid">
    <MudGrid Justify="Justify.SpaceAround">
        <MudItem>
            <MudNavLink Href="/" Class="d-flex flex-column align-center" Style="border-bottom: #725C3D solid 1px;" Match="NavLinkMatch.Prefix">                <MudImage Style="width: 35px; padding: 6px 0;" Src="../navbarIcons/home_filled.svg"></MudImage>                
                <MudText Typo="Typo.h6" Style="font-family: Montserrat;" Color="Color.Primary">HEM</MudText>            </MudNavLink>
        </MudItem>
        
        <MudItem>
            <MudNavLink @ref="ClubsLink" Href="/Clubs" Class="d-flex flex-column align-center" Style="border-bottom: #725C3D solid 1px;"  Match="NavLinkMatch.Prefix">
                @*          @if (@ClubsLink.Class.Contains("active"))
                {
                    <MudImage Style="width: 35px; padding: 6px 0;" Src="../navbarIcons/clubs_filled.svg"></MudImage>

                }
                else
                {
                    <MudImage Style="width: 35px; padding: 6px 0;" Src="../navbarIcons/clubs.svg"></MudImage>

                }*@
                <MudImage Style="width: 35px; padding: 6px 0;" Src="@isActive()"></MudImage>

                
                <MudText Typo="Typo.h6" Style="font-family: Montserrat;" Color="Color.Primary">KLUBBAR</MudText>

            </MudNavLink>
        </MudItem>

        <MudItem>
            <MudNavLink Href="/Favourites" Class="d-flex flex-column align-center" Style="border-bottom: #725C3D solid 1px;" Match="NavLinkMatch.Prefix">
                <MudImage Style="width: 35px; padding: 6px 0;" Src="../navbarIcons/favourite.svg"></MudImage>
                <MudText Typo="Typo.h6" Style="font-family: Montserrat;" Color="Color.Primary">FAVORITER</MudText>
            </MudNavLink>
        </MudItem>

        <MudItem>
            <MudNavLink Href="/MySlipp" Class="d-flex flex-column align-center" Style="border-bottom: #725C3D solid 1px;" Match="NavLinkMatch.Prefix">
                <MudImage Style="width: 35px; padding: 6px 0;" Src="../navbarIcons/ticket.svg"></MudImage>
                <MudText Typo="Typo.h6" Style="font-family: Montserrat;" Color="Color.Primary">MINA SLIPP</MudText>
            </MudNavLink>
        </MudItem>

        @if (AuthenticationService.User != null)
        {
            <MudItem>
                <MudNavLink Href="/Account" Class="d-flex flex-column align-center" Match="NavLinkMatch.Prefix">
                    <MudIcon Icon="@Icons.Filled.Person" Title="USER" Color="Color.Primary" Size="Size.Large"></MudIcon>
                    <MudText Typo="Typo.h6" Color="Color.Primary">KONTO</MudText>
                </MudNavLink>
            </MudItem>

        }
        else
        {
            <MudItem>
                <MudNavLink Href="/Login" Class="d-flex flex-column align-center" Style="border-bottom: #725C3D solid 1px;" Match="NavLinkMatch.Prefix">
                    <MudImage Style="width: 35px; padding: 6px 0;" Src="../navbarIcons/login.svg"></MudImage>
                    <MudText Typo="Typo.h6" Color="Color.Primary">LOGGA IN</MudText>
            </MudNavLink>
        </MudItem>
        
        }

    </MudGrid>
</MudAppBar>

              
@code {

    MudNavLink ClubsLink { get; set; }
    protected override void OnInitialized()
    {
        AuthenticationService.OnChange += StateHasChanged;
    }

    public void Dispose() //Save the RAM!
    {
        AuthenticationService.OnChange -= StateHasChanged;
    }

    public string isActive()
    {
        var classes = ClubsLink.Class;
        var isActive = ClubsLink.Class.Contains("active");
        if(isActive) return "../navbarIcons/clubs_filled.svg";
        return "../navbarIcons/clubs.svg";
    }

       
}
